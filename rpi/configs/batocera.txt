# For more options and information see
# http://rpf.io/configtxt
# Some settings may impact device functionality. See link above for details

# Load the 64-bit kernel
arm_64bit=1

# Kernel
kernel=boot/linux
initramfs boot/initrd.lz4

# Firmware configurations
start_file=start4.elf
fixup_file=fixup4.dat

# sets the initial CEC name of the device
cec_osd_name=batocera

# uncomment this if your display has a black border of unused pixels visible
# and your display can output without overscan
# at 0, it causes flickering on hdmi output
disable_overscan=1

# if you plug your tv at the same time as your rpi and that the rpi switches from the hdmi or give a low resolution because tv had no enough time to initialize it
boot_delay=3

# uncomment if you don't want the rainbow at startup
disable_splash=1

# Uncomment some or all of these to enable the optional hardware interfaces
dtparam=i2c_arm=on
dtparam=i2s=off
dtparam=spi=off

# Automatically load overlays for detected DSI displays
display_auto_detect=1

# Enable audio (loads snd_bcm2835)
dtparam=audio=on

# Enable bluetooth
dtparam=krnbt=on

# Enable DRM VC4 V3D driver
dtoverlay=vc4-fkms-v3d-pi4
max_framebuffers=1

# Run as fast as firmware/board allows
arm_boost=1

# Reduce I2C speed to avoid clock bug in Raspberry Pi I2C
dtparam=i2c_baudrate=25000

#disable HDMI audio
hdmi_ignore_edid_audio=1

#Configure DPI signal
framebuffer_width=800
framebuffer_height=480
enable_dpi_lcd=1
display_default_lcd=1
dpi_group=2
dpi_mode=87
dpi_output_format=503863

over_voltage=-2

[cm4]

# Enable DRM VC4 V3D driver
dtoverlay=vc4-fkms-v3d
max_framebuffers=1

# Set GPIO pins to 24-Bit DPI Mode 7
# GPIO 0 and 1 needed for DPI Clock and Data Enable
gpio=0=a2,np
gpio=1=a2,np
# Set GPIO pins 2 and 3 to I2C Mode. These can be used for other things, if needed.
gpio=2=a0,np
gpio=3=a0,np
# Set up color pins
gpio=4-27=a2,np

dpi_timings=800 0 8 4 8 480 0 8 4 8 0 0 0 60 0 25000000 6

# Enable USB
dtoverlay=dwc2,dr_mode=host

# Disable WiFi and Bluetooth
#dtoverlay=disable-wifi
#dtoverlay=disable-bt

# Disables pci-e link to prevent warning at boot
dtoverlay=disable-pcie

#enable external PSP antenna
dtparam=ant2

# Set up CM4 audio pin
dtoverlay=audiocm4

arm_freq_min=300
core_freq_min=200

[pi0]

gpu_mem_256=128
gpu_mem_512=256
gpu_mem_1024=256

#Set GPIO pins to 21-Bit DPI
#GPIO 0 and 1 needed for DPI Clock and Data Enable
gpio=0=a2,np
gpio=1=a2,np
#Set GPIO pins 2 and 3 to I2C Mode. These can be used for other things, if needed.
gpio=2=a0,np
gpio=3=a0,np
# Set up color pins
gpio=5-11=a2,np
gpio=13-19=a2,np
gpio=21-27=a2,np

dpi_timings=800 0 8 4 8 480 0 8 4 8 0 0 0 60 0 32000000 6

#Zero Stuff
#activity LED
dtparam=act_led_gpio=20

#audio
dtoverlay=audiozero

#poweroff
dtoverlay=gpio-poweroff,gpiopin=4,active_low=yes
dtparam=act_led_activelow=no

arm_freq_min=500
core_freq_min=200
